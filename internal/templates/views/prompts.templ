package views

import (
	"strconv"

	"github.com/nkapatos/mindweaver/internal/store"
	"github.com/nkapatos/mindweaver/internal/templates/layouts"
)

templ PromptsPage(prompts []store.Prompt, editingPrompt *store.Prompt) {
	@layouts.AppLayout("Mindweaver - Prompts", "Manage your prompts") {
		<div class="container mx-auto px-4 py-8">
			<div class="mb-8">
				<h1 class="text-3xl font-bold text-base-content mb-2">Prompts</h1>
				<p class="text-base-content/70">Create and manage your prompts for better knowledge management.</p>
			</div>

			<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
				<!-- Create/Edit Prompt Form -->
				<div class="card bg-base-100 shadow-lg">
					<div class="card-body">
						if editingPrompt != nil {
							<div class="flex items-center gap-4 mb-4">
								<h2 class="card-title text-xl">Edit Prompt</h2>
								<a href="/prompts" class="btn btn-ghost btn-sm">
									‚Üê Back to Create
								</a>
							</div>
							<form action={templ.SafeURL("/prompts/edit/" + strconv.FormatInt(editingPrompt.ID, 10))} method="POST" class="space-y-4">
								<div>
									<label class="label" for="title">
										<span class="label-text font-medium">Title</span>
									</label>
									<input 
										type="text" 
										id="title" 
										name="title" 
										class="input input-bordered w-full" 
										placeholder="Enter prompt title"
										value={editingPrompt.Title}
										required
									/>
								</div>

								<div>
									<label class="label" for="content">
										<span class="label-text font-medium">Content</span>
									</label>
									<textarea 
										id="content" 
										name="content" 
										class="textarea textarea-bordered w-full h-32" 
										placeholder="Enter prompt content"
										required
									>{editingPrompt.Content}</textarea>
								</div>

								<label class="label cursor-pointer">
									<span class="label-text font-medium">System Prompt</span>
									<input 
										type="checkbox" 
										id="is_system" 
										name="is_system" 
										class="checkbox checkbox-primary" 
										value="1"
										if editingPrompt.IsSystem.Valid && editingPrompt.IsSystem.Int64 == 1 {
											checked
										}
									/>
								</label>
								<label class="label">
									<span class="label-text-alt text-base-content/60">
										System prompts are used as default templates
									</span>
								</label>

								<div class="flex gap-3">
									<a href="/prompts" class="btn btn-outline flex-1">
										Cancel
									</a>
									<button type="submit" class="btn btn-primary flex-1">
										Update Prompt
									</button>
								</div>
							</form>
						} else {
							<h2 class="card-title text-xl mb-4">Create New Prompt</h2>
							<form action="/prompts" method="POST" class="space-y-4">
								<div>
									<label class="label" for="title">
										<span class="label-text font-medium">Title</span>
									</label>
									<input 
										type="text" 
										id="title" 
										name="title" 
										class="input input-bordered w-full" 
										placeholder="Enter prompt title"
										required
									/>
								</div>

								<div>
									<label class="label" for="content">
										<span class="label-text font-medium">Content</span>
									</label>
									<textarea 
										id="content" 
										name="content" 
										class="textarea textarea-bordered w-full h-32" 
										placeholder="Enter prompt content"
										required
									></textarea>
								</div>

								<label class="label cursor-pointer">
									<span class="label-text font-medium">System Prompt</span>
									<input 
										type="checkbox" 
										id="is_system" 
										name="is_system" 
										class="checkbox checkbox-primary" 
										value="1"
									/>
								</label>
								<label class="label">
									<span class="label-text-alt text-base-content/60">
										System prompts are used as default templates
									</span>
								</label>

								<button type="submit" class="btn btn-primary w-full">
									Create Prompt
								</button>
							</form>
						}
					</div>
				</div>

				<!-- Existing Prompts List -->
				<div class="card bg-base-100 shadow-lg">
					<div class="card-body">
						<h2 class="card-title text-xl mb-4">Your Prompts</h2>
						if len(prompts) == 0 {
							<div class="text-center py-8">
								<p class="text-base-content/60">No prompts created yet. Create your first prompt using the form.</p>
							</div>
						} else {
							<div class="space-y-4">
								for _, prompt := range prompts {
									<div class="border border-base-300 rounded-lg p-4">
										<div class="flex justify-between items-start mb-2">
											<h3 class="font-semibold text-lg">{prompt.Title}</h3>
											if prompt.IsSystem.Valid && prompt.IsSystem.Int64 == 1 {
												<span class="badge badge-primary badge-sm">System</span>
											}
										</div>
										<p class="text-base-content/70 text-sm mb-3 line-clamp-3">{prompt.Content}</p>
										<div class="flex justify-between items-center text-xs text-base-content/50">
											<span>ID: {strconv.FormatInt(prompt.ID, 10)}</span>
											if prompt.CreatedAt.Valid {
												<span>Created: {prompt.CreatedAt.String}</span>
											}
										</div>
										<div class="mt-3 flex gap-2">
											<a href={templ.SafeURL("/prompts/edit/" + strconv.FormatInt(prompt.ID, 10))} class="btn btn-sm btn-outline">
												Edit
											</a>
											<form action="/prompts/delete" method="POST" class="inline" onsubmit="return confirm('Are you sure you want to delete this prompt?')">
												<input type="hidden" name="id" value={strconv.FormatInt(prompt.ID, 10)} />
												<button type="submit" class="btn btn-sm btn-error">
													Delete
												</button>
											</form>
										</div>
									</div>
								}
							</div>
						}
					</div>
				</div>
			</div>
		</div>
	}
} 